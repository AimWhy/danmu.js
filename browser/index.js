window.DanmuJs=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=29)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util={createDom:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=document.createElement(t);return r.className=i,r.innerHTML=e,Object.keys(n).forEach(function(e){var i=e,o=n[e];"video"===t||"audio"===t?o&&r.setAttribute(i,o):r.setAttribute(i,o)}),r},hasClass:function(t,e){return t.classList?Array.prototype.some.call(t.classList,function(t){return t===e}):!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},addClass:function(t,e){t.classList?e.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(e){e&&t.classList.add(e)}):util.hasClass(t,e)||(t.className+=" "+e)},removeClass:function(t,e){t.classList?e.split(/\s+/g).forEach(function(e){t.classList.remove(e)}):util.hasClass(t,e)&&e.split(/\s+/g).forEach(function(e){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n," ")})},toggleClass:function(t,e){e.split(/\s+/g).forEach(function(e){util.hasClass(t,e)?util.removeClass(t,e):util.addClass(t,e)})},findDom:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments[1],n=void 0;try{n=t.querySelector(e)}catch(i){e.startsWith("#")&&(n=t.getElementById(e.slice(1)))}return n},padStart:function(t,e,n){for(var i=String(n),r=e>>0,o=Math.ceil(r/i.length),a=[],s=String(t);o--;)a.push(i);return a.join("").substring(0,r-s.length)+s},format:function(t){if(window.isNaN(t))return"";var e=util.padStart(Math.floor(t/3600),2,0),n=util.padStart(Math.floor((t-3600*e)/60),2,0),i=util.padStart(Math.floor(t-3600*e-60*n),2,0);return("00"===e?[n,i]:[e,n,i]).join(":")},event:function(t){if(t.touches){var e=t.touches[0]||t.changedTouches[0];t.clientX=e.clientX||0,t.clientY=e.clientY||0,t.offsetX=e.pageX-e.target.offsetLeft,t.offsetY=e.pageY-e.target.offsetTop}t._target=t.target||t.srcElement},typeOf:function(t){return Object.prototype.toString.call(t).match(/([^\s.*]+)(?=]$)/g)[0]},deepCopy:function(t,e){if("Object"===util.typeOf(e)&&"Object"===util.typeOf(t))return Object.keys(e).forEach(function(n){"Object"!==util.typeOf(e[n])||e[n]instanceof Node?"Array"===util.typeOf(e[n])?t[n]="Array"===util.typeOf(t[n])?t[n].concat(e[n]):e[n]:t[n]=e[n]:t[n]?util.deepCopy(t[n],e[n]):t[n]=e[n]}),t},getBgImage:function(t){var e=(t.currentStyle||window.getComputedStyle(t,null)).backgroundImage;if(!e||"none"==e)return"";var n=document.createElement("a");return n.href=e.replace(/url\("|"\)/g,""),n.href},copyDom:function(t){if(t&&1===t.nodeType){var e=document.createElement(t.tagName);return Array.prototype.forEach.call(t.attributes,function(t){e.setAttribute(t.name,t.value)}),t.innerHTML&&(e.innerHTML=t.innerHTML),e}return""},setInterval:function(t,e,n,i){t._interval[e]||(t._interval[e]=setInterval(n.bind(t),i))},clearInterval:function(t,e){clearInterval(t._interval[e]),t._interval[e]=null},createImgBtn:function(t,e,n,i){var r=util.createDom("xg-"+t,"",{},"xgplayer-"+t+"-img");if(r.style.backgroundImage='url("'+e+'")',n&&i){var o=void 0,a=void 0,s=void 0;["px","rem","em","pt","dp","vw","vh","vm","%"].every(function(t){return!(n.indexOf(t)>-1&&i.indexOf(t)>-1)||(o=parseFloat(n.slice(0,n.indexOf(t)).trim()),a=parseFloat(i.slice(0,i.indexOf(t)).trim()),s=t,!1)}),r.style.width=""+o+s,r.style.height=""+a+s,r.style.backgroundSize=""+o+s+" "+a+s,r.style.margin="start"===t?"-"+a/2+s+" auto auto -"+o/2+s:"auto 5px auto 5px"}return r},Hex2RGBA:function(hex,alpha){var rgb=[];if(/^\#[0-9A-F]{3}$/i.test(hex)){var sixHex="#";hex.replace(/[0-9A-F]/gi,function(t){sixHex+=t+t}),hex=sixHex}return/^#[0-9A-F]{6}$/i.test(hex)?(hex.replace(/[0-9A-F]{2}/gi,function(kw){rgb.push(eval("0x"+kw))}),"rgba("+rgb.join(",")+", "+alpha+")"):"rgba(255, 255, 255, 0.1)"},formatTime:function(t){var e=Math.floor(t);return 1e3*e+(t-e)}};exports.default=util,module.exports=exports.default},function(t,e,n){"use strict";var i=n(18)();t.exports=function(t){return t!==i&&null!==t}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var r,o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(r=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:i+o.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(t,e,n){var i,r,o={},a=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=i.apply(this,arguments)),r}),s=function(t){var e={};return function(t){if("function"==typeof t)return t();if(void 0===e[t]){var n=function(t){return document.querySelector(t)}.call(this,t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),u=null,l=0,c=[],f=n(2);function h(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=o[i.id];if(r){r.refs++;for(var a=0;a<r.parts.length;a++)r.parts[a](i.parts[a]);for(;a<i.parts.length;a++)r.parts.push(b(i.parts[a],e))}else{var s=[];for(a=0;a<i.parts.length;a++)s.push(b(i.parts[a],e));o[i.id]={id:i.id,refs:1,parts:s}}}}function d(t,e){for(var n=[],i={},r=0;r<t.length;r++){var o=t[r],a=e.base?o[0]+e.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}function p(t,e){var n=s(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=c[c.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),c.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=s(t.insertInto+" "+t.insertAt.before);n.insertBefore(e,r)}}function m(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=c.indexOf(t);e>=0&&c.splice(e,1)}function v(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),g(e,t.attrs),p(t,e),e}function g(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}function b(t,e){var n,i,r,o;if(e.transform&&t.css){if(!(o=e.transform(t.css)))return function(){};t.css=o}if(e.singleton){var a=l++;n=u||(u=v(e)),i=x.bind(null,n,a,!1),r=x.bind(null,n,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",g(e,t.attrs),p(t,e),e}(e),i=function(t,e,n){var i=n.css,r=n.sourceMap,o=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||o)&&(i=f(i));r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var a=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n,e),r=function(){m(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(e),i=function(t,e){var n=e.css,i=e.media;i&&t.setAttribute("media",i);if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}.bind(null,n),r=function(){m(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=a()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=d(t,e);return h(n,e),function(t){for(var i=[],r=0;r<n.length;r++){var a=n[r];(s=o[a.id]).refs--,i.push(s)}t&&h(d(t,e),e);for(r=0;r<i.length;r++){var s;if(0===(s=i[r]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete o[s.id]}}}};var y,w=(y=[],function(t,e){return y[t]=e,y.filter(Boolean).join("\n")});function x(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=w(e,r);else{var o=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(a=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),o=i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"});return[n].concat(o).concat([r]).join("\n")}var a;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(i[o]=!0)}for(r=0;r<t.length;r++){var a=t[r];"number"==typeof a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(t,e,n){(t.exports=n(4)(!1)).push([t.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#ffffff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}\n",""])},function(t,e,n){var i=n(5);"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(3)(i,r);i.locals&&(t.exports=i.locals)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(0),a=(i=o)&&i.__esModule?i:{default:i};var s=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.danmu=e,this.duration=n.duration,this.id=n.id,this.container=e.container,this.start=n.start,this.prior=n.prior,this.bookChannelId=n.bookChannelId;var i=void 0;if(n.el&&1===n.el.nodeType)i=a.default.copyDom(n.el);else if((i=document.createElement("div")).textContent=n.txt,n.style){var r=n.style;Object.keys(r).forEach(function(t){i.style[t]=r[t]})}"top"===n.mode||"bottom"===n.mode?this.mode=n.mode:this.mode="scroll",this.el=i,this.status="waiting";var o=this.container.getBoundingClientRect();this.el.style.left=o.width+"px"}return r(t,[{key:"attach",value:function(){this.container.appendChild(this.el),this.elPos=this.el.getBoundingClientRect(),this.width=this.elPos.width,this.height=this.elPos.height}},{key:"detach",value:function(){this.container&&this.el&&this.container.removeChild(this.el),this.el=null}},{key:"topInit",value:function(){this.el.style.top=this.top+"px"}},{key:"pauseMove",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("paused"!==this.status&&(this.status="paused",clearTimeout(this.removeTimer),this.el))if("scroll"===this.mode){if(e){var n=((new Date).getTime()-this.moveTime)/1e3*this.moveV,i=0;i=this.moveMoreS-n>=0?(this.moveMoreS-n)/this.moveContainerWidth*t.width:this.moveMoreS-n,this.el.style.left=i+"px"}else this.el.style.left=this.el.getBoundingClientRect().left-t.left+"px";this.el.style.transform="translateX(0px) translateY(0px) translateZ(0px)",this.el.style.transition="transform 0s linear 0s"}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+(new Date).getTime()-this.startTime:this.pastDuration=1}},{key:"startMove",value:function(t){var e=this;if(this.el&&"start"!==this.status)if(this.status="start","scroll"===this.mode){this.moveV=(t.width+this.width)/this.duration*1e3;var n=(e.el.getBoundingClientRect().right-t.left)/this.moveV;this.el.style.transition="transform "+n+"s linear 0s",setTimeout(function(){e.el&&(e.el.style.transform="translateX(-"+(e.el.getBoundingClientRect().right-t.left)+"px) translateY(0px) translateZ(0px)",e.moveTime=(new Date).getTime(),e.moveMoreS=e.el.getBoundingClientRect().left-t.left,e.moveContainerWidth=t.width,e.removeTimer=setTimeout(r,1e3*n))},20)}else{this.el.style.left="50%",this.el.style.margin="0 0 0 -"+this.width/2+"px",this.pastDuration||(this.pastDuration=1);var i=this.duration>=this.pastDuration?this.duration-this.pastDuration:0;this.removeTimer=setTimeout(r,i),this.startTime=(new Date).getTime()}function r(){if(e.el)if("scroll"===e.mode){var t=e.danmu.container.getBoundingClientRect(),n=e.el.getBoundingClientRect();n&&n.right<=t.left+100?(e.status="end",e.remove()):(e.pauseMove(t),e.startMove(t))}else e.status="end",e.remove()}}},{key:"remove",value:function(){(this.removeTimer&&clearTimeout(this.removeTimer),this.el&&this.el.parentNode)&&(this.el.parentNode.removeChild(this.el),this.el=null,this.danmu.emit("bullet_remove",{bullet:this}))}}]),t}();e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.danmu=e,this.reset();var n=this;this.danmu.on("bullet_remove",function(t){n.removeBullet(t.bullet)}),this.containerPos=this.danmu.container.getBoundingClientRect(),this.containerWidth=this.containerPos.width,this.containerHeight=this.containerPos.height,this.containerLeft=this.containerPos.left,this.containerRight=this.containerPos.right,this.danmu.bulletResizeTimer=setInterval(function(){n.containerPos=n.danmu.container.getBoundingClientRect(),(Math.abs(n.containerPos.width-n.containerWidth)>=2||Math.abs(n.containerPos.height-n.containerHeight)>=2||Math.abs(n.containerPos.left-n.containerLeft)>=2||Math.abs(n.containerPos.right-n.containerRight)>=2)&&(n.containerWidth=n.containerPos.width,n.containerHeight=n.containerPos.height,n.containerLeft=n.containerPos.left,n.containerRight=n.containerPos.right,n.resize(!0))},50)}return i(t,[{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.danmu.container,n=this;setTimeout(function(){n.danmu.bulletBtn.main.data&&n.danmu.bulletBtn.main.data.forEach(function(t){t.bookChannelId&&delete t.bookChannelId});var i=e.getBoundingClientRect();n.width=i.width,n.height=i.height,n.danmu.config.area&&n.danmu.config.area.start>=0&&n.danmu.config.area.end>=n.danmu.config.area.start&&(n.height=n.height*(n.danmu.config.area.end-n.danmu.config.area.start)),n.container=e;for(var r=/mobile/gi.test(navigator.userAgent)?10:12,o=Math.floor(n.height/r),a=[],s=0;s<o;s++)a[s]={id:s,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};if(n.channels&&n.channels.length<=a.length){for(var u=function(e){a[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top"].forEach(function(i){n.channels[e].queue[i].forEach(function(r){r.el&&(a[e].queue[i].push(r),r.resized||(r.pauseMove(n.containerPos,t),r.startMove(n.containerPos),r.resized=!0))})}),n.channels[e].queue.bottom.forEach(function(i){if(i.el){if(a[e+a.length-n.channels.length].queue.bottom.push(i),i.channel_id[0]+i.channel_id[1]-1===e){var o=[].concat(i.channel_id);i.channel_id=[o[0]-n.channels.length+a.length,o[1]],i.top=i.channel_id[0]*r,n.danmu.config.area&&n.danmu.config.area.start&&(i.top+=n.containerHeight*n.danmu.config.area.start),i.topInit()}i.resized||(i.pauseMove(n.containerPos,t),i.startMove(n.containerPos),i.resized=!0)}})},l=0;l<n.channels.length;l++)u(l);for(var c=function(t){["scroll","top","bottom"].forEach(function(e){a[t].queue[e].forEach(function(t){t.resized=!1})})},f=0;f<a.length;f++)c(f);n.channels=a,n.channelHeight=r}else if(n.channels&&n.channels.length>a.length){for(var h=function(e){a[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top","bottom"].forEach(function(i){if("top"===i&&e>Math.floor(a.length/2));else if("bottom"===i&&e<=Math.floor(a.length/2));else{var o="bottom"===i?e-a.length+n.channels.length:e;n.channels[o].queue[i].forEach(function(s,u){if(s.el){if(a[e].queue[i].push(s),"bottom"===i&&s.channel_id[0]+s.channel_id[1]-1===o){var l=[].concat(s.channel_id);s.channel_id=[l[0]-n.channels.length+a.length,l[1]],s.top=s.channel_id[0]*r,n.danmu.config.area&&n.danmu.config.area.start&&(s.top+=n.containerHeight*n.danmu.config.area.start),s.topInit()}s.resized||(s.pauseMove(n.containerPos,t),s.startMove(n.containerPos),s.resized=!0)}n.channels[o].queue[i].splice(u,1)})}})},d=0;d<a.length;d++)h(d);for(var p=function(t){["scroll","top","bottom"].forEach(function(e){n.channels[t].queue[e].forEach(function(t){t.pauseMove(n.containerPos),t.remove()})})},m=a.length;m<n.channels.length;m++)p(m);for(var v=function(t){["scroll","top","bottom"].forEach(function(e){a[t].queue[e].forEach(function(t){t.resized=!1})})},g=0;g<a.length;g++)v(g);n.channels=a,n.channelHeight=r}},10)}},{key:"addBullet",value:function(t){var e=this.danmu,n=this.channels,i=this.channelHeight,r=Math.ceil(t.height/i);if(r>n.length)return{result:!1,message:"exceed channels.length, occupy="+r+",channelsSize="+n.length};for(var o=!0,a=void 0,s=-1,u=0,l=n.length;u<l;u++)if(n[u].queue[t.mode].some(function(e){return e.id===t.id}))return{result:!1,message:"exsited, channelOrder="+u+",danmu_id="+t.id};if("scroll"===t.mode)for(var c=0,f=n.length-r;c<=f;c++){o=!0;for(var h=c;h<c+r;h++){if((a=n[h]).operating.scroll){o=!1;break}if((a.bookId.scroll||t.prior)&&a.bookId.scroll!==t.id){o=!1;break}a.operating.scroll=!0;var d=a.queue.scroll[0];if(d){var p=d.el.getBoundingClientRect();if(p.right>this.containerPos.right){o=!1,a.operating.scroll=!1;break}var m=p.left-this.containerPos.left+p.width,v=(this.containerPos.width+p.width)/d.duration,g=m/v,b=this.containerPos.width,y=(this.containerPos.width+t.width)/t.duration,w=b/y;if(e.config.bOffset||(e.config.bOffset=0),v<y&&g+e.config.bOffset>w){o=!1,a.operating.scroll=!1;break}}a.operating.scroll=!1}if(o){s=c;break}}else if("top"===t.mode)for(var x=0,k=n.length-r;x<=k;x++){o=!0;for(var _=x;_<x+r;_++){if(_>Math.floor(n.length/2)){o=!1;break}if((a=n[_]).operating[t.mode]){o=!1;break}if((a.bookId[t.mode]||t.prior)&&a.bookId[t.mode]!==t.id){o=!1;break}if(a.operating[t.mode]=!0,a.queue[t.mode].length>0){o=!1,a.operating[t.mode]=!1;break}a.operating[t.mode]=!1}if(o){s=x;break}}else if("bottom"===t.mode)for(var O=n.length-r;O>=0;O--){o=!0;for(var M=O;M<O+r;M++){if(M<=Math.floor(n.length/2)){o=!1;break}if((a=n[M]).operating[t.mode]){o=!1;break}if((a.bookId[t.mode]||t.prior)&&a.bookId[t.mode]!==t.id){o=!1;break}if(a.operating[t.mode]=!0,a.queue[t.mode].length>0){o=!1,a.operating[t.mode]=!1;break}a.operating[t.mode]=!1}if(o){s=O;break}}if(-1!==s){for(var C=s,E=s+r;C<E;C++)(a=n[C]).operating[t.mode]=!0,a.queue[t.mode].unshift(t),t.prior&&delete a.bookId[t.mode],a.operating[t.mode]=!1;if(t.prior)delete t.bookChannelId,e.bulletBtn.main.data.some(function(e){return e.id===t.id&&(delete e.bookChannelId,!0)});return t.channel_id=[s,r],t.top=s*i,this.danmu.config.area&&this.danmu.config.area.start&&(t.top+=this.containerHeight*this.danmu.config.area.start),{result:t,message:"success"}}if(t.prior)if(t.bookChannelId){e.bulletBtn.main.data.some(function(e){return e.id===t.id&&(e.start+=2e3,!0)})}else{s=-1;for(var j=0,T=n.length-r;j<=T;j++){o=!0;for(var B=j;B<j+r;B++)if(n[B].bookId[t.mode]){o=!1;break}if(o){s=j;break}}if(-1!==s){for(var P=s;P<s+r;P++)n[P].bookId[t.mode]=t.id;e.bulletBtn.main.data.some(function(e){return e.id===t.id&&(e.start+=2e3,e.bookChannelId=[s,r],!0)})}}return{result:!1,message:"no surplus will right"}}},{key:"removeBullet",value:function(t){for(var e=this.channels,n=t.channel_id,i=void 0,r=n[0],o=n[0]+n[1];r<o;r++)if(i=e[r]){i.operating[t.mode]=!0;var a=-1;i.queue[t.mode].some(function(e,n){return e.id===t.id&&(a=n,!0)}),a>-1&&i.queue[t.mode].splice(a,1),i.operating[t.mode]=!1}}},{key:"reset",value:function(){var t=this.danmu.container,e=this;e.channels&&e.channels.length>0&&["scroll","top","bottom"].forEach(function(t){for(var n=0;n<e.channels.length;n++)e.channels[n].queue[t].forEach(function(t){t.pauseMove(e.containerPos),t.remove()})}),setTimeout(function(){var n=t.getBoundingClientRect();e.width=n.width,e.height=n.height,e.danmu.config.area&&e.danmu.config.area.start>=0&&e.danmu.config.area.end>=e.danmu.config.area.start&&(e.height=e.height*(e.danmu.config.area.end-e.danmu.config.area.start)),e.container=t;for(var i=/mobile/gi.test(navigator.userAgent)?10:12,r=Math.floor(e.height/i),o=[],a=0;a<r;a++)o[a]={id:a,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};e.channels=o,e.channelHeight=i},200)}},{key:"resetWithCb",value:function(t,e){var n=this.danmu.container,i=this;i.channels&&i.channels.length>0&&["scroll","top","bottom"].forEach(function(t){for(var e=0;e<i.channels.length;e++)i.channels[e].queue[t].forEach(function(t){t.pauseMove(i.containerPos),t.remove()})});var r=n.getBoundingClientRect();i.width=r.width,i.height=r.height,i.danmu.config.area&&i.danmu.config.area.start>=0&&i.danmu.config.area.end>=i.danmu.config.area.start&&(i.height=i.height*(i.danmu.config.area.end-i.danmu.config.area.start)),i.container=n;for(var o=/mobile/gi.test(navigator.userAgent)?10:12,a=Math.floor(i.height/o),s=[],u=0;u<a;u++)s[u]={id:u,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};i.channels=s,i.channelHeight=o,t&&t(!0,e)}}]),t}();e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=s(n(8)),o=s(n(7)),a=s(n(0));function s(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.danmu=e,this.container=e.container,this.channel=new r.default(e),this.data=[].concat(e.config.comments),this.queue=[],this.timer=null,this.retryTimer=null,this.interval=2e3,this.status="idle",e.on("bullet_remove",this.updateQueue.bind(this))}return i(t,[{key:"updateQueue",value:function(t){var e=this;e.queue.some(function(n,i){return n.id===t.bullet.id&&(e.queue.splice(i,1),!0)})}},{key:"init",value:function(t,e){e||(e=this),e.data.sort(function(t,e){return t.start-e.start}),e.retryTimer||(e.retryTimer=setInterval(function(){e.readData(),e.dataHandle()},e.interval-1e3))}},{key:"start",value:function(){this.status="playing",this.queue=[],this.container.innerHTML="",this.channel.resetWithCb(this.init,this)}},{key:"stop",value:function(){this.status="closed",clearInterval(this.retryTimer),this.retryTimer=null,this.channel.reset(),this.queue=[],this.container.innerHTML=""}},{key:"play",value:function(){this.status="playing";var t=this.channel.channels,e=this.danmu.container.getBoundingClientRect();t&&t.length>0&&["scroll","top","bottom"].forEach(function(n){for(var i=0;i<t.length;i++)t[i].queue[n].forEach(function(t){t.resized||(t.startMove(e),t.resized=!0)});for(var r=0;r<t.length;r++)t[r].queue[n].forEach(function(t){t.resized=!1})})}},{key:"pause",value:function(){this.status="paused";var t=this.channel.channels,e=this.danmu.container.getBoundingClientRect();t&&t.length>0&&["scroll","top","bottom"].forEach(function(n){for(var i=0;i<t.length;i++)t[i].queue[n].forEach(function(t){t.pauseMove(e)})})}},{key:"dataHandle",value:function(){var t=this;"paused"!==this.status&&"closed"!==this.status&&t.queue.length&&t.queue.forEach(function(e){"waiting"!==e.status&&"paused"!==e.status||e.startMove(t.channel.containerPos)})}},{key:"readData",value:function(){var t=this,e=this.danmu,n=a.default.formatTime(e.player.currentTime),i=void 0,r=t.interval,s=t.channel,u=t.data.filter(function(e){return!e.start&&t.danmu.hideArr.indexOf(e.mode)<0&&(e.start=n),t.danmu.hideArr.indexOf(e.mode)<0&&e.start-r<=n&&n<=e.start+r});u.length>0&&u.forEach(function(n){(i=new o.default(e,n)).attach(),s.addBullet(i).result?(t.queue.push(i),i.topInit()):i.detach()})}}]),t}();e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=a(n(0)),o=a(n(9));function a(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.danmu=e,this.main=new o.default(e),e.config.defaultOff||this.main.start()}return i(t,[{key:"createSwitch",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.switchBtn=r.default.createDom("dk-switch",'<span class="txt">弹</span>',{},"danmu-switch "+(t?"danmu-switch-active":"")),this.switchBtn}}]),t}();e.default=s,t.exports=e.default},function(t,e,n){"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},function(t,e,n){"use strict";var i=String.prototype.indexOf;t.exports=function(t){return i.call(this,t,arguments[1])>-1}},function(t,e,n){"use strict";var i="razdwatrzy";t.exports=function(){return"function"==typeof i.contains&&(!0===i.contains("dwa")&&!1===i.contains("foo"))}},function(t,e,n){"use strict";t.exports=n(13)()?String.prototype.contains:n(12)},function(t,e,n){"use strict";t.exports=function(t){return"function"==typeof t}},function(t,e,n){"use strict";var i=n(1),r=Array.prototype.forEach,o=Object.create;t.exports=function(t){var e=o(null);return r.call(arguments,function(t){i(t)&&function(t,e){var n;for(n in t)e[n]=t[n]}(Object(t),e)}),e}},function(t,e,n){"use strict";var i=n(1);t.exports=function(t){if(!i(t))throw new TypeError("Cannot use null or undefined");return t}},function(t,e,n){"use strict";t.exports=function(){}},function(t,e,n){"use strict";var i=n(1),r=Object.keys;t.exports=function(t){return r(i(t)?Object(t):t)}},function(t,e,n){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e,n){"use strict";t.exports=n(20)()?Object.keys:n(19)},function(t,e,n){"use strict";var i=n(21),r=n(17),o=Math.max;t.exports=function(t,e){var n,a,s,u=o(arguments.length,2);for(t=Object(r(t)),s=function(i){try{t[i]=e[i]}catch(t){n||(n=t)}},a=1;a<u;++a)e=arguments[a],i(e).forEach(s);if(void 0!==n)throw n;return t}},function(t,e,n){"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,n){"use strict";t.exports=n(23)()?Object.assign:n(22)},function(t,e,n){"use strict";var i=n(24),r=n(16),o=n(15),a=n(14);(t.exports=function(t,e){var n,o,s,u,l;return arguments.length<2||"string"!=typeof t?(u=e,e=t,t=null):u=arguments[2],null==t?(n=s=!0,o=!1):(n=a.call(t,"c"),o=a.call(t,"e"),s=a.call(t,"w")),l={value:e,configurable:n,enumerable:o,writable:s},u?i(r(u),l):l}).gs=function(t,e,n){var s,u,l,c;return"string"!=typeof t?(l=n,n=e,e=t,t=null):l=arguments[3],null==e?e=void 0:o(e)?null==n?n=void 0:o(n)||(l=n,n=void 0):(l=e,e=n=void 0),null==t?(s=!0,u=!1):(s=a.call(t,"c"),u=a.call(t,"e")),c={get:e,set:n,configurable:s,enumerable:u},l?i(r(l),c):c}},function(t,e,n){"use strict";var i,r,o,a,s,u,l,c=n(25),f=n(11),h=Function.prototype.apply,d=Function.prototype.call,p=Object.create,m=Object.defineProperty,v=Object.defineProperties,g=Object.prototype.hasOwnProperty,b={configurable:!0,enumerable:!1,writable:!0};s={on:i=function(t,e){var n;return f(e),g.call(this,"__ee__")?n=this.__ee__:(n=b.value=p(null),m(this,"__ee__",b),b.value=null),n[t]?"object"==typeof n[t]?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},once:r=function(t,e){var n,r;return f(e),r=this,i.call(this,t,n=function(){o.call(r,t,n),h.call(e,this,arguments)}),n.__eeOnceListener__=e,this},off:o=function(t,e){var n,i,r,o;if(f(e),!g.call(this,"__ee__"))return this;if(!(n=this.__ee__)[t])return this;if("object"==typeof(i=n[t]))for(o=0;r=i[o];++o)r!==e&&r.__eeOnceListener__!==e||(2===i.length?n[t]=i[o?0:1]:i.splice(o,1));else i!==e&&i.__eeOnceListener__!==e||delete n[t];return this},emit:a=function(t){var e,n,i,r,o;if(g.call(this,"__ee__")&&(r=this.__ee__[t]))if("object"==typeof r){for(n=arguments.length,o=new Array(n-1),e=1;e<n;++e)o[e-1]=arguments[e];for(r=r.slice(),e=0;i=r[e];++e)h.call(i,this,o)}else switch(arguments.length){case 1:d.call(r,this);break;case 2:d.call(r,this,arguments[1]);break;case 3:d.call(r,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),e=1;e<n;++e)o[e-1]=arguments[e];h.call(r,this,o)}}},u={on:c(i),once:c(r),off:c(o),emit:c(a)},l=v({},u),t.exports=e=function(t){return null==t?p(l):v(Object(t),u)},e.methods=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=s(n(26)),o=s(n(10)),a=s(n(0));function s(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=a.default.deepCopy({overlap:!1,area:{start:0,end:1},comments:[]},e),this.hideArr=[],(0,r.default)(this);var i=this;if(this.config.comments.forEach(function(t){t.duration=t.duration<5e3?5e3:t.duration,t.mode||(t.mode="scroll")}),!this.config.container||1!==this.config.container.nodeType)return this.emit("error","container id can't be empty"),!1;if(this.container=this.config.container,this.config.containerStyle){var s=this.config.containerStyle;Object.keys(s).forEach(function(t){i.container.style[t]=s[t]})}if(!this.config.player)return this.emit("error","player can't be empty"),!1;this.player=this.config.player,a.default.addClass(this.container,"danmu"),this.bulletBtn=new o.default(this),["touchend","click","dblclick"].forEach(function(t){n.container.addEventListener(t,function(){if(i.player){i.player.focus();var e=void 0;document.createEvent?(e=document.createEvent("Event")).initEvent(t,!0,!0):e=new Event(t),i.player.dispatchEvent(e)}},!1)}),this.emit("ready")}return i(t,[{key:"start",value:function(){this.bulletBtn.main.start()}},{key:"pause",value:function(){this.bulletBtn.main.pause()}},{key:"play",value:function(){this.bulletBtn.main.play()}},{key:"stop",value:function(){this.bulletBtn.main.stop()}},{key:"sendComment",value:function(t){t&&t.id&&t.duration&&(t.el||t.txt)&&(t.duration=t.duration<5e3?5e3:t.duration,this.bulletBtn.main.data.push(t))}},{key:"setCommentID",value:function(t,e){var n=this.container.getBoundingClientRect();t&&e&&(this.bulletBtn.main.data.some(function(n){return n.id===t&&(n.id=e,!0)}),this.bulletBtn.main.queue.some(function(i){return i.id===t&&(i.id=e,i.pauseMove(n),i.startMove(n),!0)}))}},{key:"setCommentDuration",value:function(t,e){var n=this.container.getBoundingClientRect();t&&e&&(e=e<5e3?5e3:e,this.bulletBtn.main.data.some(function(n){return n.id===t&&(n.duration=e,!0)}),this.bulletBtn.main.queue.some(function(i){return i.id===t&&(i.duration=e,i.pauseMove(n),i.startMove(n),!0)}))}},{key:"setAllDuration",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",e=arguments[1],n=this.container.getBoundingClientRect();e&&(e=e<5e3?5e3:e,this.bulletBtn.main.data.forEach(function(n){t===n.mode&&(n.duration=e)}),this.bulletBtn.main.queue.forEach(function(i){t===i.mode&&(i.duration=e,i.pauseMove(n),i.startMove(n))}))}},{key:"hide",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.hideArr.indexOf(t)<0&&this.hideArr.push(t),this.bulletBtn.main.queue.filter(function(e){return t===e.mode}).forEach(function(t){return t.remove()})}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",e=this.hideArr.indexOf(t);e>-1&&this.hideArr.splice(e,1)}}]),t}();e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(27),o=(i=r)&&i.__esModule?i:{default:i};n(6),e.default=o.default,t.exports=e.default},function(t,e,n){t.exports=n(28)}]);
//# sourceMappingURL=index.js.map